<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pusilkom.base.model.mapper.DokumenOrganisasiMapper">
  <resultMap id="DokumenOrganisasiResultMap" type="com.pusilkom.base.dto.DokumenOrganisasiDTO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="id_organisasi" jdbcType="INTEGER" property="idOrganisasi" />
    <result column="nama_file" jdbcType="VARCHAR" property="namaFile" />
    <result column="file_path" jdbcType="VARCHAR" property="filePath" />
    <result column="timestamp_upload" jdbcType="TIMESTAMP" property="timestampUpload" />
    <result column="user_upload" jdbcType="VARCHAR" property="userUpload" />
    <result column="id_jenis_dokumen" jdbcType="INTEGER" property="idJenisDokumen" />
    <result column="nomor_dokumen" jdbcType="VARCHAR" property="nomorDokumen" />
    <result column="tahun_terbit" jdbcType="VARCHAR" property="tahunTerbit" />
    <result column="nama_jenis_dokumen" jdbcType="VARCHAR" property="namaJenisDokumen" />
    <result column="judul" jdbcType="VARCHAR" property="judul" />
    <result column="nama_organisasi" jdbcType="VARCHAR" property="namaOrganisasi" />
  </resultMap>

  <select id="getListData" parameterType="map" resultMap="DokumenOrganisasiResultMap">
    select dor.id, dor.id_jenis_dokumen,
    jd.nama nama_jenis_dokumen,
    dor.nama_file,
    dor.nomor_dokumen,
    dor.tahun_terbit, dor.judul
    from
    dokumen_organisasi dor
    inner join jenis_dokumen jd on
    dor.id_jenis_dokumen = jd.id
    where dor.id_organisasi = #{idOrganisasi}
    order by tahun_terbit desc
  </select>

  <select id="getDokumenPenugasanReviewer" parameterType="map" resultMap="DokumenOrganisasiResultMap">
    select a.id, a.nomor_dokumen,
      trim(COALESCE(a.judul,'') || ' (' || coalesce(a.nomor_dokumen,'') || ')' ) as judul
    from dokumen_organisasi a
    inner join jenis_dokumen b on b.id = a.id_jenis_dokumen
    where b.kelompok_dokumen='o'
    <if test="idOrganisasi != null">
      and id_organisasi = #{idOrganisasi}
    </if>
    <if test="tahunUsulan != null">
      and tahun_terbit = #{tahunUsulan}
    </if>
    <if test="kataKunci != null">
      and lower(COALESCE(a.judul,'') || ' (' || coalesce(a.nomor_dokumen,'') || ')' ) like lower(#{kataKunci})
    </if>
    order by nomor_dokumen asc
  </select>

  <select id="getDokumenTerkini" parameterType="map" resultMap="DokumenOrganisasiResultMap">
    select a.id, judul, file_path, b.nama as nama_organisasi, user_upload, timestamp_upload, tahun_terbit
    from dokumen_organisasi a
    inner join organisasi b on a.id_organisasi = b.id
    where true
    <if test="idOrganisasi != 1">
      and id_organisasi = #{idOrganisasi} or id_organisasi = 1
    </if>
    order by timestamp_upload desc
    limit 10
  </select>

</mapper>
